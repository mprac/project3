{% extends "orders/base.html" %}
{% block title %} Login {% endblock %}
{% block body %}

<h1 class="display-4">{{section.name}} in {{ menu.name }} Menu</h1> 
<!-- Check if user has address saved or request address -->
{% if user.address.get %}
Deliver to
    {{ user.address.get.street }}, {{ user.address.get.city }}, {{ user.address.get.state }} {{ user.address.get.zipcode }}
{% else %}
<p>Enter a delivery address</p>
<form action="{% url 'add_address' menu.id section.id %}" method="POST">
    {% csrf_token %}
    <input type="text" placeholder="street" name="street">
    <input type="text" placeholder="city" name="city">
    <input type="text" placeholder="state" name="state">
    <input type="number" placeholder="zipcode" name="zipcode" maxlength="5">
    <button type="submit">Add Address</button>
</form>
{% endif %}
<!-- END Check if user has address saved or request address -->


<!-- FIX THIISSSSSSSSSSSS    
    
    SECTION LINKS -->
    <script>
        const sectionlink = document.querySelectorAll('.nav-link')
    </script>
      <ul class="nav nav-tabs">
        {% for section in menu.sections.all %} 
        <li class="nav-item">
          <a class="nav-link btn-outline-danger btn btn-sm" href="{% url 'section' menu.id section.id %}">{{section.name}}</a> 
        </li>
        {% endfor %}
      </ul>
      
<!-- END SECTION LINKS -->


<br />
<!-- Regroup queried items to arrange into 2 columns or as needed -->
<div class="table-responsive">
    <table class="table table-sm ">
        {% regroup menuitems by item as item_list %}
        <tr>
            {% for items, item_name in item_list %}
            <td>
                <b>{{  items.name }} </b>
            </td>
            {% for item in item_name reversed %}
            <td>
                <a href="{% url 'create' menu.id section.id item.id %}"> <button class="btn btn-outline-success btn-sm"
                        type="submit">{{ item.size }} ${{ item.price }}</button> </a>
            </td>
            {% endfor %}
    
        </tr>
        {% endfor %}
    
    </table>
</div>

<!-- END Regroup queried items to arrange into 2 columns or as needed -->
<hr />
<!-- Show items in cart -->
{% if orders %}
<h2 id='ordersToPlace'>Your Orders</h2>

<ul id="orders">
    {% for order in orders %}
    <li>
        <form action="{% url 'delete' menu.id section.id order.id %}" method="POST">
            {% csrf_token %}
            {{ order.menuItem.item.name }} Count: {{ order.count }}
            {% for topping in order.toppings.all %}
            {{ topping.name }}
            {% endfor %}
            <button class="btn btn-outline-danger btn-sm" type="submit">Delete</button>
        </form>
    </li>
    {% endfor %}
</ul>
<hr>
{% else %}

{% endif%}

{% if cart.cart_total == 0 %}
<h2>Your Cart is empty</h2>
{% else %}
<h2>Your Cart total {{ cart.cart_total }}</h2>

<form action="{% url 'checkout' cart.id %}" method="POST">
    {% csrf_token %}
    <select name="orderOption" id="orderOption">
        <option value="PU">Pick up</option>
        <option value="DL">Delivery</option>
    </select>
    <textarea name="instructions" id="instructions" cols="30" rows="5"
        placeholder="Delivery Instructions or special requests"></textarea>
    <script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="{{ key }}"
        data-description="Pinocchio's Pizza & Subs" data-amount="{{ cart.stripe_total }}" data-locale="auto">
        </script>
    {% endif %}

</form>

<!-- END Show items in cart -->


{% endblock %}